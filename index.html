<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Photobox Pro</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#0f0f0f;
  color:white;
  text-align:center;
}
h1{margin:20px 0}
.container{padding:20px}
.preview-wrapper{
  width:320px;
  margin:auto;
  position:relative;
}
video{
  width:100%;
  border-radius:20px;
  background:black;
  transition:filter .3s;
}
.timer-display{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:60px;
  font-weight:bold;
  text-shadow:0 0 20px black;
}
.controls{margin-top:15px}
select,button{
  margin:6px;
  padding:8px 14px;
  border-radius:12px;
  border:none;
}
button{
  background:#ff4da6;
  color:white;
  cursor:pointer;
}
button:hover{opacity:.85}
.flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  pointer-events:none;
}
.flash.active{animation:flash .3s}
@keyframes flash{0%{opacity:1}100%{opacity:0}}
#finalCanvas{
  display:none;
  margin-top:25px;
  border-radius:20px;
  box-shadow:0 30px 60px rgba(0,0,0,.6);
}
label{
  font-size:12px;
  color:#facc15;
}
</style>
</head>
<body>

<h1>âœ¨ Premium Photobox Pro</h1>

<div class="container">

<div class="preview-wrapper">
  <video id="video" autoplay playsinline></video>
  <div id="timerDisplay" class="timer-display"></div>
</div>

<div class="controls">

<label>VISUAL FILTER</label><br>
<select id="basicFilter">
  <option value="none">Normal</option>
  <option value="grayscale(100%)">B&W</option>
  <option value="sepia(70%)">Vintage</option>
  <option value="brightness(110%) saturate(130%)">Golden Hour</option>
</select>
<br>

<label>ADVANCED FILTER</label><br>
<select id="advancedFilter">
  <option value="none">None</option>
  <optgroup label="Blur">
    <option value="gaussian">Gaussian Blur</option>
    <option value="motion">Motion Blur</option>
  </optgroup>
  <optgroup label="Artistic">
    <option value="poster">Poster</option>
    <option value="watercolor">Watercolor</option>
  </optgroup>
  <optgroup label="Stylize">
    <option value="emboss">Emboss</option>
    <option value="edges">Find Edges</option>
  </optgroup>
  <optgroup label="Pixelate">
    <option value="mosaic">Mosaic</option>
  </optgroup>
  <optgroup label="Beauty">
    <option value="smooth">Skin Smooth</option>
  </optgroup>
</select>
<br>

<label>TIMER</label><br>
<select id="timerSelect">
  <option value="3">3s</option>
  <option value="5">5s</option>
  <option value="10">10s</option>
</select>
<br>

<label>NUMBER OF PHOTOS</label><br>
<select id="photoCountSelect">
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4" selected>4</option>
  <option value="5">5</option>
</select>
<br>

<label>TEMPLATE</label><br>
<select id="templateSelect">
  <option value="pink">Pink</option>
  <option value="black">Black</option>
  <option value="retro">Retro</option>
  <option value="minimal" selected>Minimal</option>
</select>
<br>

<button onclick="startSession()">Start Photos</button>
<button onclick="downloadStrip()">Download</button>

</div>

<canvas id="canvas" hidden></canvas>
<canvas id="finalCanvas"></canvas>

</div>

<div class="flash" id="flash"></div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const finalCanvas = document.getElementById("finalCanvas");
const flash = document.getElementById("flash");
const timerDisplay = document.getElementById("timerDisplay");

const basicFilter = document.getElementById("basicFilter");
const advancedFilter = document.getElementById("advancedFilter");
const timerSelect = document.getElementById("timerSelect");
const photoCountSelect = document.getElementById("photoCountSelect");
const templateSelect = document.getElementById("templateSelect");

let photos = [];

/* CAMERA */
async function initCamera(){
  const stream = await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject = stream;
}
initCamera();

/* BASIC FILTER PREVIEW */
basicFilter.addEventListener("change",()=>{
  video.style.filter = basicFilter.value;
});

/* START */
async function startSession(){
  photos=[];
  finalCanvas.style.display="none";

  const delay=parseInt(timerSelect.value);
  const count=parseInt(photoCountSelect.value);

  for(let i=0;i<count;i++){
    await countdown(delay);
    capturePhoto();
  }

  await generateStrip();
}

/* COUNTDOWN */
function countdown(sec){
  return new Promise(resolve=>{
    let c=sec;
    timerDisplay.textContent=c;
    const i=setInterval(()=>{
      c--;
      timerDisplay.textContent=c>0?c:"";
      if(c<=0){clearInterval(i);resolve();}
    },1000);
  });
}

/* CAPTURE */
function capturePhoto(){
  flash.classList.add("active");
  setTimeout(()=>flash.classList.remove("active"),200);

  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;

  const ctx=canvas.getContext("2d");
  ctx.filter=basicFilter.value;
  ctx.drawImage(video,0,0);

  applyAdvancedFilter(ctx,canvas,advancedFilter.value);

  photos.push(canvas.toDataURL("image/png"));
}

/* ADVANCED FILTER */
function applyAdvancedFilter(ctx,canvas,type){
  if(type==="none") return;

  const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
  const d=imgData.data;

  if(type==="poster"){
    for(let i=0;i<d.length;i+=4){
      d[i]=d[i]>128?255:0;
      d[i+1]=d[i+1]>128?255:0;
      d[i+2]=d[i+2]>128?255:0;
    }
    ctx.putImageData(imgData,0,0);
  }

  if(type==="watercolor"){
    ctx.filter="blur(2px)";
    ctx.drawImage(canvas,0,0);
  }

  if(type==="gaussian"){
    ctx.filter="blur(6px)";
    ctx.drawImage(canvas,0,0);
  }

  if(type==="motion"){
    ctx.globalAlpha=0.2;
    for(let i=0;i<8;i++){
      ctx.drawImage(canvas,i,0);
    }
    ctx.globalAlpha=1;
  }

  if(type==="emboss"){
    for(let i=0;i<d.length;i+=4){
      d[i]+=20; d[i+1]+=20; d[i+2]+=20;
    }
    ctx.putImageData(imgData,0,0);
  }

  if(type==="edges"){
    for(let i=0;i<d.length;i+=4){
      const avg=(d[i]+d[i+1]+d[i+2])/3;
      d[i]=d[i+1]=d[i+2]=avg>120?255:0;
    }
    ctx.putImageData(imgData,0,0);
  }

  if(type==="mosaic"){
    const size=10;
    for(let y=0;y<canvas.height;y+=size){
      for(let x=0;x<canvas.width;x+=size){
        const px=ctx.getImageData(x,y,1,1).data;
        ctx.fillStyle=`rgb(${px[0]},${px[1]},${px[2]})`;
        ctx.fillRect(x,y,size,size);
      }
    }
  }

  if(type==="smooth"){
    ctx.filter="blur(3px)";
    ctx.drawImage(canvas,0,0);
  }
}

/* TEMPLATE COLOR */
function getTemplateColor(){
  const map={
    pink:"#ffe6f2",
    black:"#111",
    retro:"#f5deb3",
    minimal:"#ffffff"
  };
  return map[templateSelect.value];
}

/* STRIP */
async function generateStrip(){
  const padding=40;
  const gap=40;
  const photoWidth=300;

  const first=await loadImage(photos[0]);
  const ratio=first.height/first.width;
  const photoHeight=photoWidth*ratio;

  const width=400;
  const height=padding+(photoHeight+gap)*photos.length+100;

  finalCanvas.width=width;
  finalCanvas.height=height;

  const ctx=finalCanvas.getContext("2d");
  ctx.fillStyle=getTemplateColor();
  ctx.fillRect(0,0,width,height);

  let y=padding;

  for(let p of photos){
    const img=await loadImage(p);
    ctx.drawImage(img,50,y,photoWidth,photoHeight);
    y+=photoHeight+gap;
  }

  finalCanvas.style.display="block";
}

function loadImage(src){
  return new Promise(res=>{
    const img=new Image();
    img.onload=()=>res(img);
    img.src=src;
  });
}

function downloadStrip(){
  const link=document.createElement("a");
  link.download="photobox-pro.png";
  link.href=finalCanvas.toDataURL("image/png");
  link.click();
}
</script>

</body>
</html>
