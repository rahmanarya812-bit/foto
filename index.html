<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Photobox</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #0f0f0f;
  color: white;
  text-align: center;
}

h1 { margin: 20px 0; }

.container { padding: 20px; }

.preview-wrapper {
  width: 320px;
  margin: auto;
  position: relative;
}

video {
  width: 100%;
  border-radius: 20px;
  background: black;
  transition: filter 0.3s ease;
}

.timer-display {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 60px;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 20px black;
  pointer-events: none;
}

.controls { margin-top: 15px; }

select, button, input {
  margin: 6px;
  padding: 8px 14px;
  border-radius: 12px;
  border: none;
  font-size: 14px;
}

button {
  background: #ff4da6;
  color: white;
  cursor: pointer;
}

button:hover { opacity: 0.85; }

.flash {
  position: fixed;
  inset: 0;
  background: white;
  opacity: 0;
  pointer-events: none;
}

.flash.active {
  animation: flashAnim 0.3s ease;
}

@keyframes flashAnim {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

#finalCanvas {
  display: none;
  margin-top: 25px;
  border-radius: 20px;
  box-shadow: 0 30px 60px rgba(0,0,0,0.6);
}
</style>
</head>
<body>

<h1>âœ¨ Premium Photobox</h1>

<div class="container">

  <div class="preview-wrapper">
    <video id="video" autoplay playsinline></video>
    <div id="timerDisplay" class="timer-display"></div>
  </div>

  <div class="controls">

    <!-- VISUAL FILTER -->
    <div>
      <label style="font-size:12px;color:#facc15;">VISUAL FILTER</label><br>
      <select id="filterSelect">
        <option value="none">Normal (Clean)</option>
        <option value="grayscale(100%) contrast(110%)">B&W (Classic Noir)</option>
        <option value="sepia(60%) contrast(110%) saturate(120%)">Vintage (90s Film)</option>
        <option value="brightness(110%) saturate(130%) hue-rotate(-10deg)">Golden Hour (Warm)</option>
        <option value="contrast(120%) saturate(110%) hue-rotate(10deg)">Cinematic (Cool)</option>
      </select>
    </div>

    <!-- TIMER -->
    <div>
      <label style="font-size:12px;color:#facc15;">TIMER</label><br>
      <select id="timerSelect">
        <option value="3">3s</option>
        <option value="5">5s</option>
        <option value="10">10s</option>
      </select>
    </div>

    <select id="template">
      <option value="pink">Pink</option>
      <option value="black">Black</option>
      <option value="retro">Retro</option>
      <option value="minimal">Minimal</option>
    </select>

    <input type="file" id="logoUpload" accept="image/*">

    <br>

    <button onclick="startSession()">Start 4 Photos</button>
    <button onclick="downloadStrip()">Download</button>
  </div>

  <canvas id="canvas" hidden></canvas>
  <canvas id="finalCanvas"></canvas>

</div>

<div class="flash" id="flash"></div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const finalCanvas = document.getElementById("finalCanvas");
const templateSelect = document.getElementById("template");
const flash = document.getElementById("flash");
const logoUpload = document.getElementById("logoUpload");
const filterSelect = document.getElementById("filterSelect");
const timerSelect = document.getElementById("timerSelect");
const timerDisplay = document.getElementById("timerDisplay");

let photos = [];
let logoImage = null;

/* FILTER */
filterSelect.addEventListener("change", () => {
  video.style.filter = filterSelect.value;
});

/* CAMERA */
async function initCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
}
initCamera();

/* LOGO */
logoUpload.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    logoImage = new Image();
    logoImage.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

/* START SESSION */
async function startSession() {
  photos = [];
  finalCanvas.style.display = "none";

  const delay = parseInt(timerSelect.value);

  for (let i = 0; i < 4; i++) {
    await countdown(delay);
    capturePhoto();
  }

  await generateStrip();
}

/* COUNTDOWN */
function countdown(seconds) {
  return new Promise(resolve => {
    let count = seconds;
    timerDisplay.textContent = count;

    const interval = setInterval(() => {
      count--;
      timerDisplay.textContent = count > 0 ? count : "";
      if (count <= 0) {
        clearInterval(interval);
        resolve();
      }
    }, 1000);
  });
}

/* CAPTURE */
function capturePhoto() {
  flash.classList.add("active");
  setTimeout(() => flash.classList.remove("active"), 200);

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.filter = filterSelect.value;
  ctx.drawImage(video, 0, 0);

  photos.push(canvas.toDataURL("image/png"));
}

/* TEMPLATE */
function getTemplateColor() {
  const map = {
    pink: "#ffe6f2",
    black: "#111111",
    retro: "#f5deb3",
    minimal: "#ffffff"
  };
  return map[templateSelect.value];
}

/* STRIP */
async function generateStrip() {
  const padding = 40;
  const gap = 40;
  const photoWidth = 300;

  const firstImg = await loadImage(photos[0]);
  const ratio = firstImg.height / firstImg.width;
  const photoHeight = photoWidth * ratio;

  const width = 400;
  const height = padding + (photoHeight + gap) * 4 + 120;

  finalCanvas.width = width;
  finalCanvas.height = height;

  const ctx = finalCanvas.getContext("2d");

  ctx.fillStyle = getTemplateColor();
  ctx.fillRect(0, 0, width, height);

  let y = padding;

  for (let photo of photos) {
    const img = await loadImage(photo);

    ctx.shadowColor = "rgba(0,0,0,0.25)";
    ctx.shadowBlur = 25;
    ctx.shadowOffsetY = 10;

    ctx.fillStyle = "#fff";
    ctx.fillRect(50, y, photoWidth, photoHeight);

    ctx.shadowColor = "transparent";

    ctx.drawImage(img, 50, y, photoWidth, photoHeight);

    y += photoHeight + gap;
  }

  const date = new Date().toLocaleDateString();
  ctx.fillStyle = "#000";
  ctx.font = "18px Arial";
  ctx.textAlign = "center";
  ctx.fillText(date, width / 2, height - 80);

  if (logoImage) {
    await new Promise(res => {
      logoImage.onload = res;
      if (logoImage.complete) res();
    });
    ctx.drawImage(logoImage, width / 2 - 50, height - 140, 100, 50);
  }

  finalCanvas.style.display = "block";
}

function loadImage(src) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.src = src;
  });
}

function downloadStrip() {
  const link = document.createElement("a");
  link.download = "photobox-timer.png";
  link.href = finalCanvas.toDataURL("image/png");
  link.click();
}
</script>

</body>
</html>
