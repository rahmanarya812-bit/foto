<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Photobox - Full Original</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #0f0f0f;
  color: white;
  text-align: center;
}

h1 { margin: 20px 0; }

.container { padding: 20px; }

.preview-wrapper {
  width: 320px;
  margin: auto;
}

video {
  width: 100%;
  border-radius: 20px;
  background: black;
}

/* FLASH */
.flash {
  position: fixed;
  inset: 0;
  background: white;
  opacity: 0;
  pointer-events: none;
}

.flash.active {
  animation: flashAnim 0.3s ease;
}

@keyframes flashAnim {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

.controls { margin-top: 15px; }

button, select, input {
  margin: 6px;
  padding: 8px 14px;
  border-radius: 12px;
  border: none;
}

button {
  background: #ff4da6;
  color: white;
  cursor: pointer;
}

button:hover { opacity: 0.85; }

#finalCanvas {
  display: none;
  margin-top: 25px;
  border-radius: 20px;
  box-shadow: 0 30px 60px rgba(0,0,0,0.6);
}
</style>
</head>
<body>

<h1>âœ¨ Premium Photobox</h1>

<div class="container">

  <div class="preview-wrapper">
    <video id="video" autoplay playsinline></video>
  </div>

  <div id="timer" style="font-size:40px;margin:10px;"></div>

  <div class="controls">
    <select id="template">
      <option value="pink">Pink</option>
      <option value="black">Black</option>
      <option value="retro">Retro</option>
      <option value="minimal">Minimal</option>
    </select>

    <input type="file" id="logoUpload" accept="image/*">

    <button onclick="startSession()">Start 4 Photos</button>
    <button onclick="downloadStrip()">Download</button>
  </div>

  <canvas id="canvas" hidden></canvas>
  <canvas id="finalCanvas"></canvas>

</div>

<div class="flash" id="flash"></div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const finalCanvas = document.getElementById("finalCanvas");
const timerDisplay = document.getElementById("timer");
const templateSelect = document.getElementById("template");
const flash = document.getElementById("flash");
const logoUpload = document.getElementById("logoUpload");

let photos = [];
let logoImage = null;

/* INIT CAMERA */
async function initCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
}
initCamera();

/* LOGO */
logoUpload.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    logoImage = new Image();
    logoImage.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

/* START */
async function startSession() {
  photos = [];
  finalCanvas.style.display = "none";

  for (let i = 0; i < 4; i++) {
    await countdown(3);
    capturePhoto();
  }

  await generateStrip();
}

/* COUNTDOWN */
function countdown(seconds) {
  return new Promise(resolve => {
    let count = seconds;
    timerDisplay.textContent = count;
    const interval = setInterval(() => {
      count--;
      timerDisplay.textContent = count;
      if (count <= 0) {
        clearInterval(interval);
        timerDisplay.textContent = "";
        resolve();
      }
    }, 1000);
  });
}

/* CAPTURE FULL ORIGINAL */
function capturePhoto() {
  flash.classList.add("active");
  setTimeout(() => flash.classList.remove("active"), 200);

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  const ctx = canvas.getContext("2d");
  ctx.drawImage(video, 0, 0);

  photos.push(canvas.toDataURL("image/png"));
}

/* TEMPLATE COLOR */
function getTemplateColor() {
  const map = {
    pink: "#ffe6f2",
    black: "#111111",
    retro: "#f5deb3",
    minimal: "#ffffff"
  };
  return map[templateSelect.value];
}

/* GENERATE STRIP TANPA DISTORSI */
async function generateStrip() {

  const padding = 40;
  const gap = 40;

  const photoWidth = 300;
  const ratio = photos[0] ? 
    (await loadImage(photos[0])).height /
    (await loadImage(photos[0])).width
    : 1;

  const photoHeight = photoWidth * ratio;

  const width = 400;
  const height = padding + (photoHeight + gap) * 4 + 120;

  finalCanvas.width = width;
  finalCanvas.height = height;

  const ctx = finalCanvas.getContext("2d");

  ctx.fillStyle = getTemplateColor();
  ctx.fillRect(0, 0, width, height);

  let y = padding;

  for (let photo of photos) {
    const img = await loadImage(photo);

    ctx.shadowColor = "rgba(0,0,0,0.25)";
    ctx.shadowBlur = 25;
    ctx.shadowOffsetY = 10;

    ctx.fillStyle = "#fff";
    ctx.fillRect(50, y, photoWidth, photoHeight);

    ctx.shadowColor = "transparent";

    ctx.drawImage(img, 50, y, photoWidth, photoHeight);

    y += photoHeight + gap;
  }

  const date = new Date().toLocaleDateString();
  ctx.fillStyle = "#000";
  ctx.font = "18px Arial";
  ctx.textAlign = "center";
  ctx.fillText(date, width / 2, height - 80);

  if (logoImage) {
    await new Promise(res => {
      logoImage.onload = res;
      if (logoImage.complete) res();
    });
    ctx.drawImage(logoImage, width / 2 - 50, height - 140, 100, 50);
  }

  finalCanvas.style.display = "block";
}

function loadImage(src) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.src = src;
  });
}

function downloadStrip() {
  const link = document.createElement("a");
  link.download = "photobox-full-original.png";
  link.href = finalCanvas.toDataURL("image/png");
  link.click();
}
</script>

</body>
</html>
